import{S as Bn,i as Fn,s as Wn,k as o,q as r,a as p,l,m as i,r as u,h as t,c,n as h,b as n,F as a,C as ws}from"./index-920be987.js";function jn(cn){let v,Jt,Ue,X,Kt,Je,Z,Qt,Ke,w,E,ve,Vt,Qe,ee,$t,Ve,g,zt,we,Xt,Zt,$e,te,ea,ze,F,hn=`<code class="language-sh"><span class="token function">sudo</span> <span class="token function">apt</span> update  
<span class="token function">sudo</span> <span class="token function">apt</span> upgrade
<span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> <span class="token function">nano</span> btop</code>`,Xe,_,ta,Ee,aa,sa,Ze,W,dn=`<code class="language-sh"><span class="token function">sudo</span> swapoff <span class="token parameter variable">-a</span>
<span class="token function">sudo</span> <span class="token function">nano</span> /etc/fstab

<span class="token function">sudo</span> <span class="token function">reboot</span></code>`,et,ae,na,tt,T,I,ge,oa,at,se,la,st,j,fn=`<code class="language-sh"><span class="token function">sudo</span> snap <span class="token function">install</span> microk8s <span class="token parameter variable">--classic</span>
<span class="token function">sudo</span> snap <span class="token function">install</span> canonical-livepatch</code>`,nt,ne,ia,ot,P,ra,_e,ua,pa,lt,Y,mn=`<code class="language-sh"><span class="token function">sudo</span> microk8s status --wait-ready
<span class="token function">sudo</span> microk8s disable ha-cluster <span class="token parameter variable">--force</span>

<span class="token function">sudo</span> microk8s add-node</code>`,it,m,ca,Te,ha,da,Ie,fa,ma,rt,oe,ka,ut,q,kn='<code class="language-sh">microk8s <span class="token function">join</span> <span class="token punctuation">[</span>IP ADDRESS<span class="token punctuation">]</span>:<span class="token punctuation">[</span>LONG SECRET STRING<span class="token punctuation">]</span></code>',pt,k,ba,Pe,ya,va,xe,wa,Ea,ct,b,ga,Se,_a,Ta,Ae,Ia,Pa,ht,x,S,Oe,xa,dt,le,Sa,ft,G,bn=`<code class="language-sh"><span class="token function">sudo</span> <span class="token function">usermod</span> <span class="token parameter variable">-a</span> <span class="token parameter variable">-G</span> microk8s <span class="token environment constant">$USER</span>
<span class="token function">mkdir</span> <span class="token parameter variable">-p</span> ~/.kube
<span class="token function">chmod</span> 0700 ~/.kube

<span class="token builtin class-name">echo</span> <span class="token string">"alias kubectl='microk8s kubectl'"</span> <span class="token operator">>></span> ~/.bashrc
<span class="token builtin class-name">echo</span> <span class="token string">"alias helm='microk8s helm'"</span> <span class="token operator">>></span> ~/.bashrc
<span class="token builtin class-name">echo</span> <span class="token string">"export EDITOR=nano"</span> <span class="token operator">>></span> ~/.bashrc
<span class="token builtin class-name">source</span> ~/.bashrc 

<span class="token function">su</span> - <span class="token environment constant">$USER</span></code>`,mt,ie,Aa,kt,U,yn=`<code class="language-sh">microk8s <span class="token builtin class-name">enable</span> dns
microk8s <span class="token builtin class-name">enable</span> ingress</code>`,bt,A,Oa,Me,Ma,Da,yt,y,Ha,De,La,Ra,He,Ca,Na,vt,O,M,Le,Ba,wt,re,Fa,Et,J,vn=`<code class="language-sh">microk8s <span class="token builtin class-name">enable</span> dashboard

kubectl apply <span class="token parameter variable">-f</span> - <span class="token operator">&lt;&lt;</span><span class="token string">EOF
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: kubernetes-dashboard
  namespace: kube-system
  annotations:
    nginx.ingress.kubernetes.io/backend-protocol: HTTPS
    nginx.ingress.kubernetes.io/force-ssl-redirect: "true"
    nginx.ingress.kubernetes.io/ssl-passthrough: "true"
    nginx.ingress.kubernetes.io/whitelist-source-range: 127.0.0.1/8,192.168.0.0/16
spec:
  ingressClassName: public
  rules:
  - host: [YOUR LOCAL DOMAIN NAME GOES HERE]
    http:
      paths:
      - backend:
          service:
            name: kubernetes-dashboard
            port:
              number: 443
        path: /
        pathType: Prefix
EOF</span></code>`,gt,D,Wa,Re,ja,Ya,_t,ue,qa,Tt,K,wn='<code class="language-sh">kubectl describe secret <span class="token parameter variable">-n</span> kube-system microk8s-dashboard-token</code>',It,H,L,Ce,Ga,Pt,pe,Ua,xt,Q,En=`<code class="language-sh">helm repo <span class="token function">add</span> longhorn https://charts.longhorn.io
helm repo update</code>`,St,R,Ja,Ne,Ka,Qa,At,V,gn=`<code class="language-sh">kubectl create namespace longhorn
helm <span class="token function">install</span> longhorn longhorn/longhorn <span class="token parameter variable">--namespace</span> longhorn <span class="token punctuation"></span>
  <span class="token parameter variable">--set</span> <span class="token assign-left variable">defaultSettings.defaultDataPath</span><span class="token operator">=</span><span class="token string">"/longhorn"</span> <span class="token punctuation"></span>
  <span class="token parameter variable">--set</span> <span class="token assign-left variable">csi.kubeletRootDir</span><span class="token operator">=</span><span class="token string">"/var/snap/microk8s/common/var/lib/kubelet"</span></code>`,Ot,ce,Va,Mt,$,_n='<code class="language-sh">kubectl <span class="token parameter variable">-n</span> longhorn get pods</code>',Dt,he,$a,Ht,z,Tn=`<code class="language-sh"><span class="token function">cat</span> <span class="token operator">&lt;&lt;</span><span class="token string">EOF<span class="token bash punctuation"> <span class="token operator">|</span> microk8s kubectl apply <span class="token parameter variable">-f</span> -</span>
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: longhorn
  namespace: longhorn
  annotations:
    nginx.ingress.kubernetes.io/whitelist-source-range: 127.0.0.1/8,192.168.0.0/16
spec:
  rules:
  - host: [LONGHORN LOCAL DNS NAME]
    http:
      paths:
        - path: /
          pathType: Prefix
          backend:
            service:
              name: longhorn-frontend
              port:
                number: 80
EOF</span></code>`,Lt,C,za,Be,Xa,Za,Rt,N,B,Fe,es,Ct,de,ts,Nt,d,as,We,ss,ns,je,os,ls,Ye,is,rs,qe,us,ps,Ge,cs,hs,Bt,fe,ds;return{c(){v=o("p"),Jt=r("I run almost everything in my homelab in a kubernetes cluster. There is no other reason to that other than my personal preference tbh, so I’m not going to dive into the why kubes topic here. But, I think I’ll have to give the microk8s over k3s idea a bit of an explanation though."),Ue=p(),X=o("p"),Kt=r("Traditionally k3s is the go to choice for anything small like a homelab; and it’s great! But, lately, I spent some quality time with microk8s and ended up liking it a lot. To the point where i have chosen it over k3s for my homelab. Mostly because how low touch it is to setup and maintain a baseline cluster, and how well it is integrated with ubuntu ecosystem."),Je=p(),Z=o("p"),Qt=r("Unfortunately, microk8s being a bit of a niche choice, the documentation might be a bit sparse. So, I figured an extra tutorial won’t hurt, and hence the article. I’ll walk you through my choices as we go through them."),Ke=p(),w=o("h2"),E=o("a"),ve=o("span"),Vt=r("Initial server setup"),Qe=p(),ee=o("p"),$t=r("I’m presuming here that we have a fresh ubuntu server 24.04 installed on two machines. It could be a full or a minimal setup, doesn’t particularly matter. One of them will me main server and another is a secondary worker. Again, you might have more than two units in your cluster, it doesn’t matter either; you’ll just have to repeat a few steps on those extra machines."),Ve=p(),g=o("p"),zt=r("I strongly recommend setting up SSH on each node though. I mean unless you "),we=o("em"),Xt=r("really"),Zt=r(" want to manually type all the commands below in terminals for some reason. All my infra lives behind firewalls so, to me an SSH connection is a nobrainer."),$e=p(),te=o("p"),ea=r("Okay, with that out of the way, first off lets run the updates and add couple of standard tools"),ze=p(),F=o("pre"),Xe=p(),_=o("p"),ta=r("Second, you want to disable swap on all of your machines, and comment out the swap line of your "),Ee=o("code"),aa=r("fstab"),sa=r(" file, then reboot. Long story short for this is that kubes resources scheduler gets real confused when your pod ends up in swap. You don’t want that to happen."),Ze=p(),W=o("pre"),et=p(),ae=o("p"),na=r("Than brings us to the base line setup."),tt=p(),T=o("h2"),I=o("a"),ge=o("span"),oa=r("Kubes install"),at=p(),se=o("p"),la=r("Once your machines are back from the reboot run those two commands on each of them."),st=p(),j=o("pre"),nt=p(),ne=o("p"),ia=r("The first one installs microk8s and the second one installs kernel livepatch. Technically you don’t need the second one, but we also don’t need to live like backward savages either, do we?"),ot=p(),P=o("p"),ra=r("Once that’s done switch to your "),_e=o("em"),ua=r("master"),pa=r(" node and run the following"),lt=p(),Y=o("pre"),it=p(),m=o("p"),ca=r("The first one waits for the kubes instance to boot. By default it will boot in high availability mode, running extra stuff on your nodes. For homelab purposes I don’t really need that and could easily suffer an occasional reboot if I have to. So the second command will disable all of that and switch the cluster into a more lightweight mode and use "),Te=o("code"),ha=r("flaneld"),da=r(" and "),Ie=o("code"),fa=r("etcd"),ma=r(", similar to a standard k3s default setup."),rt=p(),oe=o("p"),ka=r("The last command will spit out a new command that looks something like this:"),ut=p(),q=o("pre"),pt=p(),k=o("p"),ba=r("copy that command, add "),Pe=o("code"),ya=r("sudo"),va=r(" in front of it and run it on "),xe=o("em"),wa=r("every"),Ea=r(" worker node. This will connect all your nodes into a single kubernetes cluster."),ct=p(),b=o("p"),ga=r("From this point on, everything you do runs from the "),Se=o("em"),_a=r("main"),Ta=r(" node "),Ae=o("em"),Ia=r("only"),Pa=r("!"),ht=p(),x=o("h2"),S=o("a"),Oe=o("span"),xa=r("Initial tooling setup"),dt=p(),le=o("p"),Sa=r("Start by running the following set of commands. It will install aliases and such for you to move forward. Microk8s is actually pretty handy as it comes with all the tools, including helm, preinstalled and namespaced:"),ft=p(),G=o("pre"),mt=p(),ie=o("p"),Aa=r("After that you want to enable the following two microk8s addons:"),kt=p(),U=o("pre"),bt=p(),A=o("p"),Oa=r("The first one installs CoreDNS to resolve kubes "),Me=o("em"),Ma=r("internal"),Da=r(" DNS names, the second one will install nginx based reverse proxy to serve as an ingress controller for all your kubes services."),yt=p(),y=o("p"),Ha=r("Technically you might want to choose "),De=o("code"),La=r("traefik"),Ra=r(" over the "),He=o("code"),Ca=r("nginx"),Na=r(" here to follow the k3s standards. It is available as a community addon in microk8s. But, it will basically do a bare bone helm install under the hood and you’ll be on your own after that. I’m a huge fan of traefik and its middleware based design, but i’m not a huge fun of chugging lots of custom yaml files around. In my experience the default nginx ingress server just as lightweight and better overall integrated with microk8s ecosystem. So I use that as the default option."),vt=p(),O=o("h2"),M=o("a"),Le=o("span"),Ba=r("Kubes dashboard"),wt=p(),re=o("p"),Fa=r("Microk8s doesn’t come with Rancher dashboard for obvious reasons. But, it has the standard kubernetes dashboard available as an addon. Which serves me just fine."),Et=p(),J=o("pre"),gt=p(),D=o("p"),Wa=r("The first command will install everything except an ingress config. I honestly don’t know why not. But, that’s a consistent choice with all the plugins in microk8s. And chucking it in doesn’t take long. Just don’t forget to enter your own domain name. And then add that host name into your laptop’s "),Re=o("code"),ja=r("/etc/hosts"),Ya=r(" file."),_t=p(),ue=o("p"),qa=r("To access your dashboard you’ll need a token which you get with the following command."),Tt=p(),K=o("pre"),It=p(),H=o("h2"),L=o("a"),Ce=o("span"),Ga=r("Longhorn"),Pt=p(),pe=o("p"),Ua=r("Microk8s comes with several options for storage. It’s not like I particularly dislike any of them, it’s just I really like longhorn. I always had a solid experience with the thing and it’s super simple to install, because it comes with an official helm script."),xt=p(),Q=o("pre"),St=p(),R=o("p"),Ja=r("Then run the following to install it in the "),Ne=o("code"),Ka=r("longhorn"),Qa=r(" namespace"),At=p(),V=o("pre"),Ot=p(),ce=o("p"),Va=r("Then watch the pods until you see them all fully spawned and running"),Mt=p(),$=o("pre"),Dt=p(),he=o("p"),$a=r("After that the only thing you’ll need is to add an ingress controller."),Ht=p(),z=o("pre"),Lt=p(),C=o("p"),za=r("And that’s pretty much all to it. Just add the DNS name into your "),Be=o("code"),Xa=r("/etc/hosts"),Za=r(" and you should be good to go."),Rt=p(),N=o("h2"),B=o("a"),Fe=o("span"),es=r("Bottom line"),Ct=p(),de=o("p"),ts=r("Well, that’s your baseline kubes cluster up an running ready for apps and extensions. And if you did kubes installs in the past I hope you do appreciate the fact that one barely needs to wrestle with any YAML configs to get it up and running. The only thing I had to feed the kubes were really the ingress controller configs. Which, depending on how you look at it, might be a fair call actually. After all it’s up to the admin how they want their services to be exposed."),Nt=p(),d=o("p"),as=r("There is actually more great and useful addons in microk8s ecosystem. The "),We=o("code"),ss=r("observability"),ns=r(" plugin for example adds promethius, graphana, and loki. Then there is "),je=o("code"),os=r("metallb"),ls=r(" if you need some decent low overhead load balancer. There is "),Ye=o("code"),is=r("cert-manager"),rs=r(" for let’s encrypt integration. The "),qe=o("code"),us=r("registry"),ps=r(" sets up local private docker image registry. There is "),Ge=o("code"),cs=r("cloudnative-pg"),hs=r(" for all your PostgreSQL needs. Etc etc."),Bt=p(),fe=o("p"),ds=r("What I really like about the microk8s addons is that they are very sensibly chosen and you can get them up and running in literally one single command. Which makes a base line kubernetes setup and maintenance into a very nice and civilised process."),this.h()},l(e){v=l(e,"P",{});var s=i(v);Jt=u(s,"I run almost everything in my homelab in a kubernetes cluster. There is no other reason to that other than my personal preference tbh, so I’m not going to dive into the why kubes topic here. But, I think I’ll have to give the microk8s over k3s idea a bit of an explanation though."),s.forEach(t),Ue=c(e),X=l(e,"P",{});var Es=i(X);Kt=u(Es,"Traditionally k3s is the go to choice for anything small like a homelab; and it’s great! But, lately, I spent some quality time with microk8s and ended up liking it a lot. To the point where i have chosen it over k3s for my homelab. Mostly because how low touch it is to setup and maintain a baseline cluster, and how well it is integrated with ubuntu ecosystem."),Es.forEach(t),Je=c(e),Z=l(e,"P",{});var gs=i(Z);Qt=u(gs,"Unfortunately, microk8s being a bit of a niche choice, the documentation might be a bit sparse. So, I figured an extra tutorial won’t hurt, and hence the article. I’ll walk you through my choices as we go through them."),gs.forEach(t),Ke=c(e),w=l(e,"H2",{id:!0});var fs=i(w);E=l(fs,"A",{"aria-hidden":!0,tabindex:!0,href:!0});var _s=i(E);ve=l(_s,"SPAN",{class:!0}),i(ve).forEach(t),_s.forEach(t),Vt=u(fs,"Initial server setup"),fs.forEach(t),Qe=c(e),ee=l(e,"P",{});var Ts=i(ee);$t=u(Ts,"I’m presuming here that we have a fresh ubuntu server 24.04 installed on two machines. It could be a full or a minimal setup, doesn’t particularly matter. One of them will me main server and another is a secondary worker. Again, you might have more than two units in your cluster, it doesn’t matter either; you’ll just have to repeat a few steps on those extra machines."),Ts.forEach(t),Ve=c(e),g=l(e,"P",{});var Ft=i(g);zt=u(Ft,"I strongly recommend setting up SSH on each node though. I mean unless you "),we=l(Ft,"EM",{});var Is=i(we);Xt=u(Is,"really"),Is.forEach(t),Zt=u(Ft," want to manually type all the commands below in terminals for some reason. All my infra lives behind firewalls so, to me an SSH connection is a nobrainer."),Ft.forEach(t),$e=c(e),te=l(e,"P",{});var Ps=i(te);ea=u(Ps,"Okay, with that out of the way, first off lets run the updates and add couple of standard tools"),Ps.forEach(t),ze=c(e),F=l(e,"PRE",{class:!0});var In=i(F);In.forEach(t),Xe=c(e),_=l(e,"P",{});var Wt=i(_);ta=u(Wt,"Second, you want to disable swap on all of your machines, and comment out the swap line of your "),Ee=l(Wt,"CODE",{});var xs=i(Ee);aa=u(xs,"fstab"),xs.forEach(t),sa=u(Wt," file, then reboot. Long story short for this is that kubes resources scheduler gets real confused when your pod ends up in swap. You don’t want that to happen."),Wt.forEach(t),Ze=c(e),W=l(e,"PRE",{class:!0});var Pn=i(W);Pn.forEach(t),et=c(e),ae=l(e,"P",{});var Ss=i(ae);na=u(Ss,"Than brings us to the base line setup."),Ss.forEach(t),tt=c(e),T=l(e,"H2",{id:!0});var ms=i(T);I=l(ms,"A",{"aria-hidden":!0,tabindex:!0,href:!0});var As=i(I);ge=l(As,"SPAN",{class:!0}),i(ge).forEach(t),As.forEach(t),oa=u(ms,"Kubes install"),ms.forEach(t),at=c(e),se=l(e,"P",{});var Os=i(se);la=u(Os,"Once your machines are back from the reboot run those two commands on each of them."),Os.forEach(t),st=c(e),j=l(e,"PRE",{class:!0});var xn=i(j);xn.forEach(t),nt=c(e),ne=l(e,"P",{});var Ms=i(ne);ia=u(Ms,"The first one installs microk8s and the second one installs kernel livepatch. Technically you don’t need the second one, but we also don’t need to live like backward savages either, do we?"),Ms.forEach(t),ot=c(e),P=l(e,"P",{});var jt=i(P);ra=u(jt,"Once that’s done switch to your "),_e=l(jt,"EM",{});var Ds=i(_e);ua=u(Ds,"master"),Ds.forEach(t),pa=u(jt," node and run the following"),jt.forEach(t),lt=c(e),Y=l(e,"PRE",{class:!0});var Sn=i(Y);Sn.forEach(t),it=c(e),m=l(e,"P",{});var me=i(m);ca=u(me,"The first one waits for the kubes instance to boot. By default it will boot in high availability mode, running extra stuff on your nodes. For homelab purposes I don’t really need that and could easily suffer an occasional reboot if I have to. So the second command will disable all of that and switch the cluster into a more lightweight mode and use "),Te=l(me,"CODE",{});var Hs=i(Te);ha=u(Hs,"flaneld"),Hs.forEach(t),da=u(me," and "),Ie=l(me,"CODE",{});var Ls=i(Ie);fa=u(Ls,"etcd"),Ls.forEach(t),ma=u(me,", similar to a standard k3s default setup."),me.forEach(t),rt=c(e),oe=l(e,"P",{});var Rs=i(oe);ka=u(Rs,"The last command will spit out a new command that looks something like this:"),Rs.forEach(t),ut=c(e),q=l(e,"PRE",{class:!0});var An=i(q);An.forEach(t),pt=c(e),k=l(e,"P",{});var ke=i(k);ba=u(ke,"copy that command, add "),Pe=l(ke,"CODE",{});var Cs=i(Pe);ya=u(Cs,"sudo"),Cs.forEach(t),va=u(ke," in front of it and run it on "),xe=l(ke,"EM",{});var Ns=i(xe);wa=u(Ns,"every"),Ns.forEach(t),Ea=u(ke," worker node. This will connect all your nodes into a single kubernetes cluster."),ke.forEach(t),ct=c(e),b=l(e,"P",{});var be=i(b);ga=u(be,"From this point on, everything you do runs from the "),Se=l(be,"EM",{});var Bs=i(Se);_a=u(Bs,"main"),Bs.forEach(t),Ta=u(be," node "),Ae=l(be,"EM",{});var Fs=i(Ae);Ia=u(Fs,"only"),Fs.forEach(t),Pa=u(be,"!"),be.forEach(t),ht=c(e),x=l(e,"H2",{id:!0});var ks=i(x);S=l(ks,"A",{"aria-hidden":!0,tabindex:!0,href:!0});var Ws=i(S);Oe=l(Ws,"SPAN",{class:!0}),i(Oe).forEach(t),Ws.forEach(t),xa=u(ks,"Initial tooling setup"),ks.forEach(t),dt=c(e),le=l(e,"P",{});var js=i(le);Sa=u(js,"Start by running the following set of commands. It will install aliases and such for you to move forward. Microk8s is actually pretty handy as it comes with all the tools, including helm, preinstalled and namespaced:"),js.forEach(t),ft=c(e),G=l(e,"PRE",{class:!0});var On=i(G);On.forEach(t),mt=c(e),ie=l(e,"P",{});var Ys=i(ie);Aa=u(Ys,"After that you want to enable the following two microk8s addons:"),Ys.forEach(t),kt=c(e),U=l(e,"PRE",{class:!0});var Mn=i(U);Mn.forEach(t),bt=c(e),A=l(e,"P",{});var Yt=i(A);Oa=u(Yt,"The first one installs CoreDNS to resolve kubes "),Me=l(Yt,"EM",{});var qs=i(Me);Ma=u(qs,"internal"),qs.forEach(t),Da=u(Yt," DNS names, the second one will install nginx based reverse proxy to serve as an ingress controller for all your kubes services."),Yt.forEach(t),yt=c(e),y=l(e,"P",{});var ye=i(y);Ha=u(ye,"Technically you might want to choose "),De=l(ye,"CODE",{});var Gs=i(De);La=u(Gs,"traefik"),Gs.forEach(t),Ra=u(ye," over the "),He=l(ye,"CODE",{});var Us=i(He);Ca=u(Us,"nginx"),Us.forEach(t),Na=u(ye," here to follow the k3s standards. It is available as a community addon in microk8s. But, it will basically do a bare bone helm install under the hood and you’ll be on your own after that. I’m a huge fan of traefik and its middleware based design, but i’m not a huge fun of chugging lots of custom yaml files around. In my experience the default nginx ingress server just as lightweight and better overall integrated with microk8s ecosystem. So I use that as the default option."),ye.forEach(t),vt=c(e),O=l(e,"H2",{id:!0});var bs=i(O);M=l(bs,"A",{"aria-hidden":!0,tabindex:!0,href:!0});var Js=i(M);Le=l(Js,"SPAN",{class:!0}),i(Le).forEach(t),Js.forEach(t),Ba=u(bs,"Kubes dashboard"),bs.forEach(t),wt=c(e),re=l(e,"P",{});var Ks=i(re);Fa=u(Ks,"Microk8s doesn’t come with Rancher dashboard for obvious reasons. But, it has the standard kubernetes dashboard available as an addon. Which serves me just fine."),Ks.forEach(t),Et=c(e),J=l(e,"PRE",{class:!0});var Dn=i(J);Dn.forEach(t),gt=c(e),D=l(e,"P",{});var qt=i(D);Wa=u(qt,"The first command will install everything except an ingress config. I honestly don’t know why not. But, that’s a consistent choice with all the plugins in microk8s. And chucking it in doesn’t take long. Just don’t forget to enter your own domain name. And then add that host name into your laptop’s "),Re=l(qt,"CODE",{});var Qs=i(Re);ja=u(Qs,"/etc/hosts"),Qs.forEach(t),Ya=u(qt," file."),qt.forEach(t),_t=c(e),ue=l(e,"P",{});var Vs=i(ue);qa=u(Vs,"To access your dashboard you’ll need a token which you get with the following command."),Vs.forEach(t),Tt=c(e),K=l(e,"PRE",{class:!0});var Hn=i(K);Hn.forEach(t),It=c(e),H=l(e,"H2",{id:!0});var ys=i(H);L=l(ys,"A",{"aria-hidden":!0,tabindex:!0,href:!0});var $s=i(L);Ce=l($s,"SPAN",{class:!0}),i(Ce).forEach(t),$s.forEach(t),Ga=u(ys,"Longhorn"),ys.forEach(t),Pt=c(e),pe=l(e,"P",{});var zs=i(pe);Ua=u(zs,"Microk8s comes with several options for storage. It’s not like I particularly dislike any of them, it’s just I really like longhorn. I always had a solid experience with the thing and it’s super simple to install, because it comes with an official helm script."),zs.forEach(t),xt=c(e),Q=l(e,"PRE",{class:!0});var Ln=i(Q);Ln.forEach(t),St=c(e),R=l(e,"P",{});var Gt=i(R);Ja=u(Gt,"Then run the following to install it in the "),Ne=l(Gt,"CODE",{});var Xs=i(Ne);Ka=u(Xs,"longhorn"),Xs.forEach(t),Qa=u(Gt," namespace"),Gt.forEach(t),At=c(e),V=l(e,"PRE",{class:!0});var Rn=i(V);Rn.forEach(t),Ot=c(e),ce=l(e,"P",{});var Zs=i(ce);Va=u(Zs,"Then watch the pods until you see them all fully spawned and running"),Zs.forEach(t),Mt=c(e),$=l(e,"PRE",{class:!0});var Cn=i($);Cn.forEach(t),Dt=c(e),he=l(e,"P",{});var en=i(he);$a=u(en,"After that the only thing you’ll need is to add an ingress controller."),en.forEach(t),Ht=c(e),z=l(e,"PRE",{class:!0});var Nn=i(z);Nn.forEach(t),Lt=c(e),C=l(e,"P",{});var Ut=i(C);za=u(Ut,"And that’s pretty much all to it. Just add the DNS name into your "),Be=l(Ut,"CODE",{});var tn=i(Be);Xa=u(tn,"/etc/hosts"),tn.forEach(t),Za=u(Ut," and you should be good to go."),Ut.forEach(t),Rt=c(e),N=l(e,"H2",{id:!0});var vs=i(N);B=l(vs,"A",{"aria-hidden":!0,tabindex:!0,href:!0});var an=i(B);Fe=l(an,"SPAN",{class:!0}),i(Fe).forEach(t),an.forEach(t),es=u(vs,"Bottom line"),vs.forEach(t),Ct=c(e),de=l(e,"P",{});var sn=i(de);ts=u(sn,"Well, that’s your baseline kubes cluster up an running ready for apps and extensions. And if you did kubes installs in the past I hope you do appreciate the fact that one barely needs to wrestle with any YAML configs to get it up and running. The only thing I had to feed the kubes were really the ingress controller configs. Which, depending on how you look at it, might be a fair call actually. After all it’s up to the admin how they want their services to be exposed."),sn.forEach(t),Nt=c(e),d=l(e,"P",{});var f=i(d);as=u(f,"There is actually more great and useful addons in microk8s ecosystem. The "),We=l(f,"CODE",{});var nn=i(We);ss=u(nn,"observability"),nn.forEach(t),ns=u(f," plugin for example adds promethius, graphana, and loki. Then there is "),je=l(f,"CODE",{});var on=i(je);os=u(on,"metallb"),on.forEach(t),ls=u(f," if you need some decent low overhead load balancer. There is "),Ye=l(f,"CODE",{});var ln=i(Ye);is=u(ln,"cert-manager"),ln.forEach(t),rs=u(f," for let’s encrypt integration. The "),qe=l(f,"CODE",{});var rn=i(qe);us=u(rn,"registry"),rn.forEach(t),ps=u(f," sets up local private docker image registry. There is "),Ge=l(f,"CODE",{});var un=i(Ge);cs=u(un,"cloudnative-pg"),un.forEach(t),hs=u(f," for all your PostgreSQL needs. Etc etc."),f.forEach(t),Bt=c(e),fe=l(e,"P",{});var pn=i(fe);ds=u(pn,"What I really like about the microk8s addons is that they are very sensibly chosen and you can get them up and running in literally one single command. Which makes a base line kubernetes setup and maintenance into a very nice and civilised process."),pn.forEach(t),this.h()},h(){h(ve,"class","icon icon-link"),h(E,"aria-hidden","true"),h(E,"tabindex","-1"),h(E,"href","#initial-server-setup"),h(w,"id","initial-server-setup"),h(F,"class","language-sh"),h(W,"class","language-sh"),h(ge,"class","icon icon-link"),h(I,"aria-hidden","true"),h(I,"tabindex","-1"),h(I,"href","#kubes-install"),h(T,"id","kubes-install"),h(j,"class","language-sh"),h(Y,"class","language-sh"),h(q,"class","language-sh"),h(Oe,"class","icon icon-link"),h(S,"aria-hidden","true"),h(S,"tabindex","-1"),h(S,"href","#initial-tooling-setup"),h(x,"id","initial-tooling-setup"),h(G,"class","language-sh"),h(U,"class","language-sh"),h(Le,"class","icon icon-link"),h(M,"aria-hidden","true"),h(M,"tabindex","-1"),h(M,"href","#kubes-dashboard"),h(O,"id","kubes-dashboard"),h(J,"class","language-sh"),h(K,"class","language-sh"),h(Ce,"class","icon icon-link"),h(L,"aria-hidden","true"),h(L,"tabindex","-1"),h(L,"href","#longhorn"),h(H,"id","longhorn"),h(Q,"class","language-sh"),h(V,"class","language-sh"),h($,"class","language-sh"),h(z,"class","language-sh"),h(Fe,"class","icon icon-link"),h(B,"aria-hidden","true"),h(B,"tabindex","-1"),h(B,"href","#bottom-line"),h(N,"id","bottom-line")},m(e,s){n(e,v,s),a(v,Jt),n(e,Ue,s),n(e,X,s),a(X,Kt),n(e,Je,s),n(e,Z,s),a(Z,Qt),n(e,Ke,s),n(e,w,s),a(w,E),a(E,ve),a(w,Vt),n(e,Qe,s),n(e,ee,s),a(ee,$t),n(e,Ve,s),n(e,g,s),a(g,zt),a(g,we),a(we,Xt),a(g,Zt),n(e,$e,s),n(e,te,s),a(te,ea),n(e,ze,s),n(e,F,s),F.innerHTML=hn,n(e,Xe,s),n(e,_,s),a(_,ta),a(_,Ee),a(Ee,aa),a(_,sa),n(e,Ze,s),n(e,W,s),W.innerHTML=dn,n(e,et,s),n(e,ae,s),a(ae,na),n(e,tt,s),n(e,T,s),a(T,I),a(I,ge),a(T,oa),n(e,at,s),n(e,se,s),a(se,la),n(e,st,s),n(e,j,s),j.innerHTML=fn,n(e,nt,s),n(e,ne,s),a(ne,ia),n(e,ot,s),n(e,P,s),a(P,ra),a(P,_e),a(_e,ua),a(P,pa),n(e,lt,s),n(e,Y,s),Y.innerHTML=mn,n(e,it,s),n(e,m,s),a(m,ca),a(m,Te),a(Te,ha),a(m,da),a(m,Ie),a(Ie,fa),a(m,ma),n(e,rt,s),n(e,oe,s),a(oe,ka),n(e,ut,s),n(e,q,s),q.innerHTML=kn,n(e,pt,s),n(e,k,s),a(k,ba),a(k,Pe),a(Pe,ya),a(k,va),a(k,xe),a(xe,wa),a(k,Ea),n(e,ct,s),n(e,b,s),a(b,ga),a(b,Se),a(Se,_a),a(b,Ta),a(b,Ae),a(Ae,Ia),a(b,Pa),n(e,ht,s),n(e,x,s),a(x,S),a(S,Oe),a(x,xa),n(e,dt,s),n(e,le,s),a(le,Sa),n(e,ft,s),n(e,G,s),G.innerHTML=bn,n(e,mt,s),n(e,ie,s),a(ie,Aa),n(e,kt,s),n(e,U,s),U.innerHTML=yn,n(e,bt,s),n(e,A,s),a(A,Oa),a(A,Me),a(Me,Ma),a(A,Da),n(e,yt,s),n(e,y,s),a(y,Ha),a(y,De),a(De,La),a(y,Ra),a(y,He),a(He,Ca),a(y,Na),n(e,vt,s),n(e,O,s),a(O,M),a(M,Le),a(O,Ba),n(e,wt,s),n(e,re,s),a(re,Fa),n(e,Et,s),n(e,J,s),J.innerHTML=vn,n(e,gt,s),n(e,D,s),a(D,Wa),a(D,Re),a(Re,ja),a(D,Ya),n(e,_t,s),n(e,ue,s),a(ue,qa),n(e,Tt,s),n(e,K,s),K.innerHTML=wn,n(e,It,s),n(e,H,s),a(H,L),a(L,Ce),a(H,Ga),n(e,Pt,s),n(e,pe,s),a(pe,Ua),n(e,xt,s),n(e,Q,s),Q.innerHTML=En,n(e,St,s),n(e,R,s),a(R,Ja),a(R,Ne),a(Ne,Ka),a(R,Qa),n(e,At,s),n(e,V,s),V.innerHTML=gn,n(e,Ot,s),n(e,ce,s),a(ce,Va),n(e,Mt,s),n(e,$,s),$.innerHTML=_n,n(e,Dt,s),n(e,he,s),a(he,$a),n(e,Ht,s),n(e,z,s),z.innerHTML=Tn,n(e,Lt,s),n(e,C,s),a(C,za),a(C,Be),a(Be,Xa),a(C,Za),n(e,Rt,s),n(e,N,s),a(N,B),a(B,Fe),a(N,es),n(e,Ct,s),n(e,de,s),a(de,ts),n(e,Nt,s),n(e,d,s),a(d,as),a(d,We),a(We,ss),a(d,ns),a(d,je),a(je,os),a(d,ls),a(d,Ye),a(Ye,is),a(d,rs),a(d,qe),a(qe,us),a(d,ps),a(d,Ge),a(Ge,cs),a(d,hs),n(e,Bt,s),n(e,fe,s),a(fe,ds)},p:ws,i:ws,o:ws,d(e){e&&t(v),e&&t(Ue),e&&t(X),e&&t(Je),e&&t(Z),e&&t(Ke),e&&t(w),e&&t(Qe),e&&t(ee),e&&t(Ve),e&&t(g),e&&t($e),e&&t(te),e&&t(ze),e&&t(F),e&&t(Xe),e&&t(_),e&&t(Ze),e&&t(W),e&&t(et),e&&t(ae),e&&t(tt),e&&t(T),e&&t(at),e&&t(se),e&&t(st),e&&t(j),e&&t(nt),e&&t(ne),e&&t(ot),e&&t(P),e&&t(lt),e&&t(Y),e&&t(it),e&&t(m),e&&t(rt),e&&t(oe),e&&t(ut),e&&t(q),e&&t(pt),e&&t(k),e&&t(ct),e&&t(b),e&&t(ht),e&&t(x),e&&t(dt),e&&t(le),e&&t(ft),e&&t(G),e&&t(mt),e&&t(ie),e&&t(kt),e&&t(U),e&&t(bt),e&&t(A),e&&t(yt),e&&t(y),e&&t(vt),e&&t(O),e&&t(wt),e&&t(re),e&&t(Et),e&&t(J),e&&t(gt),e&&t(D),e&&t(_t),e&&t(ue),e&&t(Tt),e&&t(K),e&&t(It),e&&t(H),e&&t(Pt),e&&t(pe),e&&t(xt),e&&t(Q),e&&t(St),e&&t(R),e&&t(At),e&&t(V),e&&t(Ot),e&&t(ce),e&&t(Mt),e&&t($),e&&t(Dt),e&&t(he),e&&t(Ht),e&&t(z),e&&t(Lt),e&&t(C),e&&t(Rt),e&&t(N),e&&t(Ct),e&&t(de),e&&t(Nt),e&&t(d),e&&t(Bt),e&&t(fe)}}}const qn={slug:"czFmXY",date:"16 November 2024",title:"Setting up a microk8s cluster in a homelab",description:"A quick guide how to setup a working kubernetes cluster for a homelab using ubuntu server and microk8s",tags:["kubernetes","linux","homelab"]};class Gn extends Bn{constructor(v){super(),Fn(this,v,null,jn,Wn,{})}}export{Gn as default,qn as metadata};
