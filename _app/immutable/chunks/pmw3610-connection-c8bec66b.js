import{S as Mo,i as No,s as qo,k as s,q as i,a as d,l as r,m as l,r as a,h as t,c as f,n as h,b as c,F as o,C as oo}from"./index-920be987.js";function Lo(Ho){let y,Ke,be,b,k,J,ze,ke,H,Be,Pe,M,Fe,Se,N,Ue,Ee,u,q,G,Ye,Je,Ge,L,V,Ve,Xe,Ze,P,X,$e,et,Z,tt,ot,it,S,$,at,st,ee,rt,lt,_e,E,_,te,nt,Ce,C,ct,oe,ht,dt,Oe,j,ft,xe,O,pt,ie,ut,wt,De,x,D,ae,mt,ge,K,vt,Te,p,It,se,yt,bt,re,kt,Pt,le,St,Et,ne,_t,Ct,Ae,g,T,ce,Ot,Qe,m,xt,he,Dt,gt,de,Tt,At,Re,z,Qt,We,B,Rt,He,A,Q,fe,Wt,Me,v,Ht,pe,Mt,Nt,ue,qt,Lt,Ne,F,jt,qe,w,Kt,we,zt,Bt,me,Ft,Ut,ve,Yt,Jt;return{c(){y=s("p"),Ke=i("So, I had this itch to make a keyboard with an integrated trackball. Which took me onto a spelunking quest of figuring out how optical sensors work, SPI interfaces, and such. The information is not all that great on the subject because keyboards with integrated pointy devices are still a bit niche. So, I’m dumping everything I know here in hope that it might help someone down the track."),be=d(),b=s("h2"),k=s("a"),J=s("span"),ze=i("How SPI interfaces work"),ke=d(),H=s("p"),Be=i("If you know everything about SPIs, just skip this section, but I think it’s a fundamental piece that leads to understanding how to connect peripherals to chips. Which is a bit on oxymoron because everything is a chip. And in the world of chips when two or more of them want to talk to each other, like an optical sensor and a ProMicro MCU for example, they use protocols."),Pe=d(),M=s("p"),Fe=i("The most standard way to wire things together is known as Serial Peripheral Interface or SPI for short. It is normally consists of 6 wires and otherwise known as “4 wire SPI”, which is a bit confusing, but easily explained because we have 2 wires for power and 4 wires for data. It looks like so."),Se=d(),N=s("p"),Ue=i("The 4 data wires is basically a full-duplex interface used like so"),Ee=d(),u=s("ul"),q=s("li"),G=s("code"),Ye=i("PICO"),Je=i(" (formerly known as MISO)- stands for “Processor In Chip Out” and used for the chip to send data to the processor"),Ge=d(),L=s("li"),V=s("code"),Ve=i("POCI"),Xe=i(" (formerly known as MOSI) - stands for “Processor Out Chip In” and used for the processor to send data to the chip"),Ze=d(),P=s("li"),X=s("code"),$e=i("SCK"),et=i(" (sometimes called "),Z=s("code"),tt=i("SCLK"),ot=i(") - stands for “System ClocK” and as you might guess used for comms synchronisation"),it=d(),S=s("li"),$=s("code"),at=i("CS"),st=i(" (sometimes called "),ee=s("code"),rt=i("NCS"),lt=i(") - is used for selecting a device, more on that in a second"),_e=d(),E=s("h2"),_=s("a"),te=s("span"),nt=i("SPI and multiple devices"),Ce=d(),C=s("p"),ct=i("The reason why SPI has so many wires and that mystical "),oe=s("code"),ht=i("CS"),dt=i(" wire is that multiple devices can be daisy chained on the same set of wires. 4 wires might be an overkill for a single device, but if you need to attach six of them to the same controller, SPI very quickly becomes a live saviour because micro-controllers usually have a limited number of pins."),Oe=d(),j=s("p"),ft=i("When we daisy chain several devices on the same SPI bus, here how it looks like:"),xe=d(),O=s("p"),pt=i("Now notice that every device has a separate "),ie=s("code"),ut=i("CS"),wt=i(" wire, and that is what lets the micro-controller to choose which device it talks to on the SPI bus at every single moment."),De=d(),x=s("h2"),D=s("a"),ae=s("span"),mt=i("3-wire SPI"),ge=d(),K=s("p"),vt=i("Another quirk of SPI interfaces that we need to be aware in this instance is a SPI variation called a “3-wire SPI”. What it basically does it uses one single wire to communicate between chips and a processor instead of two like in a 4-wire SPI:"),Te=d(),p=s("p"),It=i("As you can see in this instance instead of dedicated "),se=s("code"),yt=i("PICO"),bt=i("/"),re=s("code"),kt=i("POCI"),Pt=i(" wires, we have a single wire which is traditionally called "),le=s("code"),St=i("SDIO"),Et=i(" which a short for “Serial Data In/Out”. There is some software magic to make the half-duplex work. But otherwise it acts as a normal SPI bus. Including the ability to daisy chaining devices with extra "),ne=s("code"),_t=i("CS"),Ct=i(" wires."),Ae=d(),g=s("h2"),T=s("a"),ce=s("span"),Ot=i("SPI IRQ wire"),Qe=d(),m=s("p"),xt=i("And the last piece of the puzzle is called "),he=s("code"),Dt=i("IRQ"),gt=i(" wire. It is a term used for SPI interrupt signal; I know it doesn’t abbreviate to "),de=s("code"),Tt=i("IRQ"),At=i(". I honestly don’t know what it stands for, but my theory it is for “InterRupt Queue”."),Re=d(),z=s("p"),Qt=i("The basic idea is the following. There can be all sorts of things happening over an SPI bus, including the controller going into a low power mode. Now imagine you have an optical chip that watches a mouse or a trackball. What happens when you move trackball/mouse and your processor is either busy with other stuff or went to sleep? That’s right we need a way to interrupt it start processing the movement data right away. Hence the IRQ wire."),We=d(),B=s("p"),Rt=i("While the sensor is detecting movement it can send an IRQ signal to the processor to prioritise the movement data processing."),He=d(),A=s("h2"),Q=s("a"),fe=s("span"),Wt=i("Back to our optical sensor"),Me=d(),v=s("p"),Ht=i("The easiest way to think about the pmw3610 optical sensor is a 3-wire SPI device with an IRQ. The complicating factor here is that it also needs two separate sources of power "),pe=s("code"),Mt=i("3.3v"),Nt=i(" and "),ue=s("code"),qt=i("1.8v"),Lt=i(", so one will need a power step-down MOSFET and such. Otherwise it just some usual capacitors for killing the parasite signals and such. Here is the schematic for my trackball sensor for a reference."),Ne=d(),F=s("p"),jt=i("![[pmw3610-schematic.png]]"),qe=d(),w=s("p"),Kt=i("You can see the 6 wire standard SPI socket with labels at the bottom right corner where everything come together. Well except it is not entirely a standard 6 wire SPI, because instead of "),we=s("code"),zt=i("PICO/POCI"),Bt=i(" wires we have "),me=s("code"),Ft=i("SDIO"),Ut=i(" for a 3-wire SPI and an "),ve=s("code"),Yt=i("IRQ"),Jt=i(" wire."),this.h()},l(e){y=r(e,"P",{});var n=l(y);Ke=a(n,"So, I had this itch to make a keyboard with an integrated trackball. Which took me onto a spelunking quest of figuring out how optical sensors work, SPI interfaces, and such. The information is not all that great on the subject because keyboards with integrated pointy devices are still a bit niche. So, I’m dumping everything I know here in hope that it might help someone down the track."),n.forEach(t),be=f(e),b=r(e,"H2",{id:!0});var Gt=l(b);k=r(Gt,"A",{"aria-hidden":!0,tabindex:!0,href:!0});var io=l(k);J=r(io,"SPAN",{class:!0}),l(J).forEach(t),io.forEach(t),ze=a(Gt,"How SPI interfaces work"),Gt.forEach(t),ke=f(e),H=r(e,"P",{});var ao=l(H);Be=a(ao,"If you know everything about SPIs, just skip this section, but I think it’s a fundamental piece that leads to understanding how to connect peripherals to chips. Which is a bit on oxymoron because everything is a chip. And in the world of chips when two or more of them want to talk to each other, like an optical sensor and a ProMicro MCU for example, they use protocols."),ao.forEach(t),Pe=f(e),M=r(e,"P",{});var so=l(M);Fe=a(so,"The most standard way to wire things together is known as Serial Peripheral Interface or SPI for short. It is normally consists of 6 wires and otherwise known as “4 wire SPI”, which is a bit confusing, but easily explained because we have 2 wires for power and 4 wires for data. It looks like so."),so.forEach(t),Se=f(e),N=r(e,"P",{});var ro=l(N);Ue=a(ro,"The 4 data wires is basically a full-duplex interface used like so"),ro.forEach(t),Ee=f(e),u=r(e,"UL",{});var R=l(u);q=r(R,"LI",{});var Vt=l(q);G=r(Vt,"CODE",{});var lo=l(G);Ye=a(lo,"PICO"),lo.forEach(t),Je=a(Vt," (formerly known as MISO)- stands for “Processor In Chip Out” and used for the chip to send data to the processor"),Vt.forEach(t),Ge=f(R),L=r(R,"LI",{});var Xt=l(L);V=r(Xt,"CODE",{});var no=l(V);Ve=a(no,"POCI"),no.forEach(t),Xe=a(Xt," (formerly known as MOSI) - stands for “Processor Out Chip In” and used for the processor to send data to the chip"),Xt.forEach(t),Ze=f(R),P=r(R,"LI",{});var Ie=l(P);X=r(Ie,"CODE",{});var co=l(X);$e=a(co,"SCK"),co.forEach(t),et=a(Ie," (sometimes called "),Z=r(Ie,"CODE",{});var ho=l(Z);tt=a(ho,"SCLK"),ho.forEach(t),ot=a(Ie,") - stands for “System ClocK” and as you might guess used for comms synchronisation"),Ie.forEach(t),it=f(R),S=r(R,"LI",{});var ye=l(S);$=r(ye,"CODE",{});var fo=l($);at=a(fo,"CS"),fo.forEach(t),st=a(ye," (sometimes called "),ee=r(ye,"CODE",{});var po=l(ee);rt=a(po,"NCS"),po.forEach(t),lt=a(ye,") - is used for selecting a device, more on that in a second"),ye.forEach(t),R.forEach(t),_e=f(e),E=r(e,"H2",{id:!0});var Zt=l(E);_=r(Zt,"A",{"aria-hidden":!0,tabindex:!0,href:!0});var uo=l(_);te=r(uo,"SPAN",{class:!0}),l(te).forEach(t),uo.forEach(t),nt=a(Zt,"SPI and multiple devices"),Zt.forEach(t),Ce=f(e),C=r(e,"P",{});var Le=l(C);ct=a(Le,"The reason why SPI has so many wires and that mystical "),oe=r(Le,"CODE",{});var wo=l(oe);ht=a(wo,"CS"),wo.forEach(t),dt=a(Le," wire is that multiple devices can be daisy chained on the same set of wires. 4 wires might be an overkill for a single device, but if you need to attach six of them to the same controller, SPI very quickly becomes a live saviour because micro-controllers usually have a limited number of pins."),Le.forEach(t),Oe=f(e),j=r(e,"P",{});var mo=l(j);ft=a(mo,"When we daisy chain several devices on the same SPI bus, here how it looks like:"),mo.forEach(t),xe=f(e),O=r(e,"P",{});var je=l(O);pt=a(je,"Now notice that every device has a separate "),ie=r(je,"CODE",{});var vo=l(ie);ut=a(vo,"CS"),vo.forEach(t),wt=a(je," wire, and that is what lets the micro-controller to choose which device it talks to on the SPI bus at every single moment."),je.forEach(t),De=f(e),x=r(e,"H2",{id:!0});var $t=l(x);D=r($t,"A",{"aria-hidden":!0,tabindex:!0,href:!0});var Io=l(D);ae=r(Io,"SPAN",{class:!0}),l(ae).forEach(t),Io.forEach(t),mt=a($t,"3-wire SPI"),$t.forEach(t),ge=f(e),K=r(e,"P",{});var yo=l(K);vt=a(yo,"Another quirk of SPI interfaces that we need to be aware in this instance is a SPI variation called a “3-wire SPI”. What it basically does it uses one single wire to communicate between chips and a processor instead of two like in a 4-wire SPI:"),yo.forEach(t),Te=f(e),p=r(e,"P",{});var I=l(p);It=a(I,"As you can see in this instance instead of dedicated "),se=r(I,"CODE",{});var bo=l(se);yt=a(bo,"PICO"),bo.forEach(t),bt=a(I,"/"),re=r(I,"CODE",{});var ko=l(re);kt=a(ko,"POCI"),ko.forEach(t),Pt=a(I," wires, we have a single wire which is traditionally called "),le=r(I,"CODE",{});var Po=l(le);St=a(Po,"SDIO"),Po.forEach(t),Et=a(I," which a short for “Serial Data In/Out”. There is some software magic to make the half-duplex work. But otherwise it acts as a normal SPI bus. Including the ability to daisy chaining devices with extra "),ne=r(I,"CODE",{});var So=l(ne);_t=a(So,"CS"),So.forEach(t),Ct=a(I," wires."),I.forEach(t),Ae=f(e),g=r(e,"H2",{id:!0});var eo=l(g);T=r(eo,"A",{"aria-hidden":!0,tabindex:!0,href:!0});var Eo=l(T);ce=r(Eo,"SPAN",{class:!0}),l(ce).forEach(t),Eo.forEach(t),Ot=a(eo,"SPI IRQ wire"),eo.forEach(t),Qe=f(e),m=r(e,"P",{});var U=l(m);xt=a(U,"And the last piece of the puzzle is called "),he=r(U,"CODE",{});var _o=l(he);Dt=a(_o,"IRQ"),_o.forEach(t),gt=a(U," wire. It is a term used for SPI interrupt signal; I know it doesn’t abbreviate to "),de=r(U,"CODE",{});var Co=l(de);Tt=a(Co,"IRQ"),Co.forEach(t),At=a(U,". I honestly don’t know what it stands for, but my theory it is for “InterRupt Queue”."),U.forEach(t),Re=f(e),z=r(e,"P",{});var Oo=l(z);Qt=a(Oo,"The basic idea is the following. There can be all sorts of things happening over an SPI bus, including the controller going into a low power mode. Now imagine you have an optical chip that watches a mouse or a trackball. What happens when you move trackball/mouse and your processor is either busy with other stuff or went to sleep? That’s right we need a way to interrupt it start processing the movement data right away. Hence the IRQ wire."),Oo.forEach(t),We=f(e),B=r(e,"P",{});var xo=l(B);Rt=a(xo,"While the sensor is detecting movement it can send an IRQ signal to the processor to prioritise the movement data processing."),xo.forEach(t),He=f(e),A=r(e,"H2",{id:!0});var to=l(A);Q=r(to,"A",{"aria-hidden":!0,tabindex:!0,href:!0});var Do=l(Q);fe=r(Do,"SPAN",{class:!0}),l(fe).forEach(t),Do.forEach(t),Wt=a(to,"Back to our optical sensor"),to.forEach(t),Me=f(e),v=r(e,"P",{});var Y=l(v);Ht=a(Y,"The easiest way to think about the pmw3610 optical sensor is a 3-wire SPI device with an IRQ. The complicating factor here is that it also needs two separate sources of power "),pe=r(Y,"CODE",{});var go=l(pe);Mt=a(go,"3.3v"),go.forEach(t),Nt=a(Y," and "),ue=r(Y,"CODE",{});var To=l(ue);qt=a(To,"1.8v"),To.forEach(t),Lt=a(Y,", so one will need a power step-down MOSFET and such. Otherwise it just some usual capacitors for killing the parasite signals and such. Here is the schematic for my trackball sensor for a reference."),Y.forEach(t),Ne=f(e),F=r(e,"P",{});var Ao=l(F);jt=a(Ao,"![[pmw3610-schematic.png]]"),Ao.forEach(t),qe=f(e),w=r(e,"P",{});var W=l(w);Kt=a(W,"You can see the 6 wire standard SPI socket with labels at the bottom right corner where everything come together. Well except it is not entirely a standard 6 wire SPI, because instead of "),we=r(W,"CODE",{});var Qo=l(we);zt=a(Qo,"PICO/POCI"),Qo.forEach(t),Bt=a(W," wires we have "),me=r(W,"CODE",{});var Ro=l(me);Ft=a(Ro,"SDIO"),Ro.forEach(t),Ut=a(W," for a 3-wire SPI and an "),ve=r(W,"CODE",{});var Wo=l(ve);Yt=a(Wo,"IRQ"),Wo.forEach(t),Jt=a(W," wire."),W.forEach(t),this.h()},h(){h(J,"class","icon icon-link"),h(k,"aria-hidden","true"),h(k,"tabindex","-1"),h(k,"href","#how-spi-interfaces-work"),h(b,"id","how-spi-interfaces-work"),h(te,"class","icon icon-link"),h(_,"aria-hidden","true"),h(_,"tabindex","-1"),h(_,"href","#spi-and-multiple-devices"),h(E,"id","spi-and-multiple-devices"),h(ae,"class","icon icon-link"),h(D,"aria-hidden","true"),h(D,"tabindex","-1"),h(D,"href","#3-wire-spi"),h(x,"id","3-wire-spi"),h(ce,"class","icon icon-link"),h(T,"aria-hidden","true"),h(T,"tabindex","-1"),h(T,"href","#spi-irq-wire"),h(g,"id","spi-irq-wire"),h(fe,"class","icon icon-link"),h(Q,"aria-hidden","true"),h(Q,"tabindex","-1"),h(Q,"href","#back-to-our-optical-sensor"),h(A,"id","back-to-our-optical-sensor")},m(e,n){c(e,y,n),o(y,Ke),c(e,be,n),c(e,b,n),o(b,k),o(k,J),o(b,ze),c(e,ke,n),c(e,H,n),o(H,Be),c(e,Pe,n),c(e,M,n),o(M,Fe),c(e,Se,n),c(e,N,n),o(N,Ue),c(e,Ee,n),c(e,u,n),o(u,q),o(q,G),o(G,Ye),o(q,Je),o(u,Ge),o(u,L),o(L,V),o(V,Ve),o(L,Xe),o(u,Ze),o(u,P),o(P,X),o(X,$e),o(P,et),o(P,Z),o(Z,tt),o(P,ot),o(u,it),o(u,S),o(S,$),o($,at),o(S,st),o(S,ee),o(ee,rt),o(S,lt),c(e,_e,n),c(e,E,n),o(E,_),o(_,te),o(E,nt),c(e,Ce,n),c(e,C,n),o(C,ct),o(C,oe),o(oe,ht),o(C,dt),c(e,Oe,n),c(e,j,n),o(j,ft),c(e,xe,n),c(e,O,n),o(O,pt),o(O,ie),o(ie,ut),o(O,wt),c(e,De,n),c(e,x,n),o(x,D),o(D,ae),o(x,mt),c(e,ge,n),c(e,K,n),o(K,vt),c(e,Te,n),c(e,p,n),o(p,It),o(p,se),o(se,yt),o(p,bt),o(p,re),o(re,kt),o(p,Pt),o(p,le),o(le,St),o(p,Et),o(p,ne),o(ne,_t),o(p,Ct),c(e,Ae,n),c(e,g,n),o(g,T),o(T,ce),o(g,Ot),c(e,Qe,n),c(e,m,n),o(m,xt),o(m,he),o(he,Dt),o(m,gt),o(m,de),o(de,Tt),o(m,At),c(e,Re,n),c(e,z,n),o(z,Qt),c(e,We,n),c(e,B,n),o(B,Rt),c(e,He,n),c(e,A,n),o(A,Q),o(Q,fe),o(A,Wt),c(e,Me,n),c(e,v,n),o(v,Ht),o(v,pe),o(pe,Mt),o(v,Nt),o(v,ue),o(ue,qt),o(v,Lt),c(e,Ne,n),c(e,F,n),o(F,jt),c(e,qe,n),c(e,w,n),o(w,Kt),o(w,we),o(we,zt),o(w,Bt),o(w,me),o(me,Ft),o(w,Ut),o(w,ve),o(ve,Yt),o(w,Jt)},p:oo,i:oo,o:oo,d(e){e&&t(y),e&&t(be),e&&t(b),e&&t(ke),e&&t(H),e&&t(Pe),e&&t(M),e&&t(Se),e&&t(N),e&&t(Ee),e&&t(u),e&&t(_e),e&&t(E),e&&t(Ce),e&&t(C),e&&t(Oe),e&&t(j),e&&t(xe),e&&t(O),e&&t(De),e&&t(x),e&&t(ge),e&&t(K),e&&t(Te),e&&t(p),e&&t(Ae),e&&t(g),e&&t(Qe),e&&t(m),e&&t(Re),e&&t(z),e&&t(We),e&&t(B),e&&t(He),e&&t(A),e&&t(Me),e&&t(v),e&&t(Ne),e&&t(F),e&&t(qe),e&&t(w)}}}const Ko={slug:null,date:"2 January 2025",title:"How to integrate PMW3610 optical sensor into keyboard/mouse",description:"Capturing some info about wiring a pmw3610 optical sensor to a ProMicro based keyboard/mouse or anything else really",tags:["keyboard","electronics","promicro","engineering"],draft:!0};class zo extends Mo{constructor(y){super(),No(this,y,null,Lo,qo,{})}}export{zo as default,Ko as metadata};
